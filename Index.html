<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catholic Prayer Guide & Tracker</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Georgia', serif;
      line-height: 1.6;
      color:#333;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;
    }

    .hidden { display:none !important; }

    .container {
      max-width:800px; margin:0 auto; padding:20px;
      background:#fff; min-height:100vh;
      box-shadow:0 0 20px rgba(0,0,0,0.1);
    }

    .header {
      text-align:center; margin-bottom:30px; padding:20px 0;
      border-bottom:3px solid #8B4513;
    }

    .header h1 { color:#8B4513; font-size:2.2em; margin-bottom:10px; }

    .prayer-selector { margin-bottom:20px; text-align:center; }
    .prayer-selector select {
      padding:12px 20px; font-size:16px; border:2px solid #8B4513;
      border-radius:8px; background:#fff; color:#8B4513; font-weight:bold;
    }

    .mystery-selector { margin-bottom:30px; text-align:center; }
    .mystery-selector select {
      padding:10px 15px; font-size:14px; border:2px solid #666;
      border-radius:6px; background:#fff;
    }

    .hour-selector { margin-bottom:20px; text-align:center; }
    .hour-selector select {
      padding:10px 15px; font-size:14px; border:2px solid #4682b4;
      border-radius:6px; background:#fff; color:#4682b4; font-weight:bold;
    }

    .prayer-section { display:none; margin-bottom:30px; }
    .prayer-section.active { display:block; }

    .section-title {
      color:#8B4513; font-size:1.8em; text-align:center; margin-bottom:20px;
      padding:15px; background:#f8f4e6; border-radius:10px; border:2px solid #8B4513;
    }

    .instructions {
      background:#fff8dc; padding:20px; border-radius:10px; margin-bottom:25px;
      border-left:5px solid #8B4513;
    }
    .instructions h3 { color:#8B4513; margin-bottom:15px; font-size:1.3em; }
    .instructions ol, .instructions ul { margin-left:20px; }
    .instructions li { margin-bottom:8px; }

    .mystery-group {
      margin-bottom:40px; border:2px solid #ddd; border-radius:10px;
      padding:20px; background:#fafafa;
    }
    .mystery-title {
      color:#8B4513; font-size:1.4em; margin-bottom:15px; text-align:center; font-weight:bold;
    }
    .mystery-description {
      background:#f0f8ff; padding:15px; border-radius:8px; margin-bottom:20px;
      border-left:4px solid #4682b4;
    }
    .meditation-instructions {
      background:#f5f5dc; padding:15px; border-radius:8px; margin-bottom:20px;
      border-left:4px solid #daa520;
    }
    .meditation-instructions h4 { color:#8B4513; margin-bottom:10px; }

    .prayer-item {
      background:#fff; margin-bottom:15px; padding:15px; border-radius:8px;
      border:1px solid #ddd; box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    .prayer-checkbox { display:flex; align-items:flex-start; gap:12px; margin-bottom:10px; }
    .prayer-checkbox input[type="checkbox"] { margin-top:4px; transform:scale(1.2); }
    .prayer-text { flex:1; font-style:italic; color:#444; line-height:1.7; }
    .prayer-label { font-weight:bold; color:#8B4513; margin-bottom:8px; display:block; }
    .repetition-note { font-size:0.9em; color:#666; margin-top:8px; }

    .hour-group {
      margin-bottom:25px; border:2px solid #4682b4; border-radius:10px;
      padding:20px; background:#f0f8ff;
    }
    .hour-title {
      color:#4682b4; font-size:1.4em; margin-bottom:15px; text-align:center; font-weight:bold;
    }

    /* Modal */
    .modal {
      display:flex; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%;
      background:rgba(0,0,0,0.5); align-items:center; justify-content:center;
    }
    .modal-content {
      background:#fff; padding:30px; border-radius:15px; text-align:center;
      max-width:400px; width:90%; box-shadow:0 10px 25px rgba(0,0,0,0.3);
    }
    .modal h2 { color:#8B4513; margin-bottom:20px; font-size:1.6em; }
    .modal select {
      padding:15px; font-size:16px; border:2px solid #8B4513; border-radius:8px;
      width:100%; margin-bottom:20px; background:#fff;
    }
    .modal button {
      padding:12px 30px; font-size:16px; background:#8B4513; color:#fff;
      border:none; border-radius:8px; cursor:pointer; font-weight:bold;
    }
    .modal button:hover { background:#654321; }

    /* Daily Readings */
    #dailyReadingsWidget { margin:16px 0 16px; text-align:center; }
    #readingSelect {
      padding:10px 15px; border:2px solid #8B4513; border-radius:8px; min-width:260px;
    }
    #openReadingBtn {
      padding:10px 16px; margin-left:8px; background:#8B4513; color:#fff;
      border:none; border-radius:8px; font-weight:bold;
    }
    #readingsCredit { margin-top:8px; }
    #readingsFrameWrap { border:1px solid #ddd; border-radius:8px; overflow:hidden; }
    #readingsFrame { width:100%; height:700px; border:0; display:block; }

    /* Text-only readings layout */
    #readingsTextWrap { display:none; }
    .reading-card {
      border:1px solid #e6e6e6; border-radius:10px; padding:16px; margin:14px 0; background:#fff;
    }
    .reading-card h3 { color:#8B4513; margin-bottom:8px; }
    .reading-card small { color:#555; font-style:italic; }

    /* Liturgy of the Hours */
    #liturgyHoursWidget { margin:16px 0 16px; text-align:center; }
    #hourSelect {
      padding:10px 15px; border:2px solid #4682b4; border-radius:8px; min-width:200px;
    }
    #openHourBtn {
      padding:10px 16px; margin-left:8px; background:#4682b4; color:#fff;
      border:none; border-radius:8px; font-weight:bold;
    }
    #liturgyFrame { width:100%; height:700px; border:0; display:block; border-radius:8px; }

    @media (max-width:600px){
      .container{ padding:10px; }
      .header h1{ font-size:1.8em; }
      .prayer-item{ padding:10px; }
      #readingsFrame, #liturgyFrame { height:520px; }
    }
  </style>
</head>
<body>
  <!-- Modal for prayer selection -->
  <div id="prayerModal" class="modal" aria-modal="true" role="dialog">
    <div class="modal-content">
      <h2>Choose Your Prayer</h2>
      <select id="modalPrayerSelect">
        <option value="rosary">The Holy Rosary</option>
        <option value="divine-mercy">Divine Mercy Chaplet</option>
        <option value="st-benedict">St. Benedict Chaplet</option>
        <option value="liturgy-hours">Liturgy of the Hours</option>
        <option value="daily-readings">Daily Readings</option>
      </select>
      <!-- Keep inline onclick AND attach a JS listener for robustness -->
      <button id="beginPrayerBtn" onclick="startPrayer()">Begin Prayer</button>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <h1>✝ Catholic Prayer Guide & Tracker ✝</h1>
      <p>A spiritual companion for your daily devotions</p>
    </div>

    <!-- Main selector -->
    <div class="prayer-selector">
      <select id="prayerTypeSelect" onchange="switchPrayer()">
        <option value="rosary">The Holy Rosary</option>
        <option value="divine-mercy">Divine Mercy Chaplet</option>
        <option value="st-benedict">St. Benedict Chaplet</option>
        <option value="liturgy-hours">Liturgy of the Hours</option>
        <option value="daily-readings">Daily Readings</option>
      </select>
    </div>

    <!-- Rosary Section -->
    <div id="rosary" class="prayer-section">
      <div class="section-title">The Holy Rosary</div>

      <div class="mystery-selector">
        <label for="mysterySelect"><strong>Select Mysteries:</strong></label>
        <select id="mysterySelect" onchange="switchMystery()">
          <option value="joyful">Joyful Mysteries (Monday & Saturday)</option>
          <option value="sorrowful">Sorrowful Mysteries (Tuesday & Friday)</option>
          <option value="glorious">Glorious Mysteries (Wednesday & Sunday)</option>
          <option value="luminous">Luminous Mysteries (Thursday)</option>
        </select>
      </div>

      <div class="instructions">
        <h3>How to Pray the Rosary</h3>
        <ol>
          <li>Begin with the Sign of the Cross and the Apostles' Creed</li>
          <li>Pray one Our Father, three Hail Marys, and one Glory Be</li>
          <li>For each of the five mysteries: announce the mystery, pray one Our Father, ten Hail Marys, one Glory Be, and the Fatima Prayer</li>
          <li>Conclude with the Hail Holy Queen and final prayer</li>
        </ol>
      </div>

      <div id="rosaryPrayers"></div>
    </div>

    <!-- Divine Mercy Section -->
    <div id="divine-mercy" class="prayer-section">
      <div class="section-title">Divine Mercy Chaplet</div>

      <div class="instructions">
        <h3>How to Pray the Divine Mercy Chaplet</h3>
        <ol>
          <li>Begin with the Sign of the Cross</li>
          <li>Pray one Our Father, one Hail Mary, and the Apostles' Creed</li>
          <li>On the large bead before each decade, pray the "Eternal Father" prayer</li>
          <li>On the small beads of each decade, pray "For the sake of His sorrowful Passion..."</li>
          <li>Repeat for all five decades</li>
          <li>Conclude with the closing prayer three times</li>
        </ol>
        <p><strong>Best prayed at 3:00 PM (the Hour of Mercy) or anytime with devotion.</strong></p>
      </div>

      <div id="divineMercyPrayers"></div>
    </div>

    <!-- St. Benedict Section -->
    <div id="st-benedict" class="prayer-section">
      <div class="section-title">St. Benedict Chaplet</div>

      <div class="instructions">
        <h3>How to Pray the St. Benedict Chaplet</h3>
        <ol>
          <li>Begin with the Sign of the Cross</li>
          <li>Pray the opening prayer to St. Benedict</li>
          <li>On the large beads, pray the Our Father</li>
          <li>On the small beads, pray "Blessed St. Benedict..."</li>
          <li>Repeat for all four decades</li>
          <li>Conclude with the closing prayer</li>
        </ol>
        <p><strong>This chaplet asks for St. Benedict's protection against evil and temptation.</strong></p>
      </div>

      <div id="stBenedictPrayers"></div>
    </div>

    <!-- Liturgy of the Hours Section -->
    <div id="liturgy-hours" class="prayer-section">
      <div class="section-title">Liturgy of the Hours</div>

      <div class="instructions">
        <h3>The Divine Office - Prayer of the Church</h3>
        <p>The Liturgy of the Hours, also known as the Divine Office, is the daily prayer of the Catholic Church, marking the hours of each day and sanctifying the day with prayer.</p>
        <p><strong>Traditional prayer times:</strong></p>
        <ul>
          <li><strong>Office of Readings:</strong> Any time - reflection on Scripture</li>
          <li><strong>Morning Prayer (Lauds):</strong> Upon rising - dedication of the day</li>
          <li><strong>Midmorning Prayer (Terce):</strong> ~9 AM - invocation of Holy Spirit</li>
          <li><strong>Midday Prayer (Sext):</strong> ~12 PM - renewal for afternoon</li>
          <li><strong>Midafternoon Prayer (None):</strong> ~3 PM - hour of Jesus' death</li>
          <li><strong>Evening Prayer (Vespers):</strong> ~6 PM - thanksgiving for day</li>
          <li><strong>Night Prayer (Compline):</strong> Before bed - examination & peace</li>
        </ul>
      </div>

      <div class="hour-selector">
        <label for="hourSelect"><strong>Select Hour:</strong></label>
        <select id="hourSelect" onchange="switchHour()">
          <option value="office-readings">Office of Readings</option>
          <option value="morning">Morning Prayer (Lauds)</option>
          <option value="midmorning">Midmorning Prayer (Terce)</option>
          <option value="midday">Midday Prayer (Sext)</option>
          <option value="midafternoon">Midafternoon Prayer (None)</option>
          <option value="evening">Evening Prayer (Vespers)</option>
          <option value="night">Night Prayer (Compline)</option>
        </select>
      </div>

      <div id="liturgyHoursWidget">
        <label for="liturgySourceSelect"><strong>Source:</strong></label>
        <select id="liturgySourceSelect">
          <option value="universalis">Universalis (full page)</option>
          <option value="universalis-mobile">Universalis (mobile view)</option>
        </select>
        <button id="openHourBtn">Open Prayer</button>
        <div id="liturgyCredit" class="repetition-note">
          Powered by Universalis. The Liturgy of the Hours changes daily according to the Church calendar.
        </div>
      </div>

      <div id="liturgyFrameWrap">
        <iframe id="liturgyFrame" title="Liturgy of the Hours" src="https://universalis.com/"></iframe>
      </div>
    </div>

    <!-- Daily Readings Section -->
    <div id="daily-readings" class="prayer-section">
      <div class="section-title">Daily Mass Readings</div>
      <div class="instructions">
        <h3>Pick a Source / Mode</h3>
        <ul>
          <li><strong>Universalis (text-only)</strong> – minimal Bible text (no images/menus).</li>
          <li><strong>Universalis (inline)</strong> – full Universalis page inside this site.</li>
          <li><strong>USCCB (new tab)</strong> – opens today's USCCB page (they block embedding).</li>
        </ul>
      </div>

      <div id="dailyReadingsWidget">
        <label for="readingSelect"><strong>Source:</strong></label>
        <select id="readingSelect">
          <option value="universalis-text">Universalis (text-only)</option>
          <option value="universalis">Universalis (inline)</option>
          <option value="usccb">USCCB (new tab)</option>
        </select>
        <button id="openReadingBtn">Open</button>
        <div id="readingsCredit" class="repetition-note">
          Text-only mode powered by Universalis JSONP. Full page via iframe. USCCB in new tab.
        </div>
      </div>

      <!-- Text-only readings -->
      <div id="readingsTextWrap">
        <div class="reading-card">
          <h3 id="Universalis_date">Today</h3>
          <div id="Universalis_day"></div>
        </div>

        <div class="reading-card" id="firstReadingCard">
          <h3>First Reading <small id="Universalis_Mass_R1.source"></small></h3>
          <p><em id="Universalis_Mass_R1.heading"></em></p>
          <div id="Universalis_Mass_R1.text"></div>
        </div>

        <div class="reading-card">
          <h3>Responsorial Psalm <small id="Universalis_Mass_Ps.source"></small></h3>
          <div id="Universalis_Mass_Ps.text"></div>
        </div>

        <div class="reading-card" id="secondReadingCard">
          <h3>Second Reading <small id="Universalis_Mass_R2.source"></small></h3>
          <p><em id="Universalis_Mass_R2.heading"></em></p>
          <div id="Universalis_Mass_R2.text"></div>
        </div>

        <div class="reading-card">
          <h3>Gospel <small id="Universalis_Mass_G.source"></small></h3>
          <p><em id="Universalis_Mass_G.heading"></em></p>
          <div id="Universalis_Mass_G.text"></div>
        </div>

        <div class="repetition-note" id="Universalis_copyright.text"></div>
        <div class="repetition-note">
          <a href="https://www.universalis.com/mass.htm" target="_blank" rel="noopener">View on Universalis</a>
        </div>
      </div>

      <!-- Full Universalis page -->
      <div id="readingsFrameWrap">
        <iframe id="readingsFrame" title="Daily Readings (Universalis)" src="https://universalis.com/mass.htm"></iframe>
      </div>
    </div>
  </div>

  <script>
    // ===============================
    // Prayer data
    // ===============================
    const prayerData = {
      rosary: {
        opening: [
          { label:"Sign of the Cross", text:"In the name of the Father, and of the Son, and of the Holy Spirit. Amen." },
          { label:"Apostles' Creed", text:"I believe in God, the Father almighty, Creator of heaven and earth, and in Jesus Christ, his only Son, our Lord, who was conceived by the Holy Spirit, born of the Virgin Mary, suffered under Pontius Pilate, was crucified, died and was buried; he descended into hell; on the third day he rose again from the dead; he ascended into heaven, and is seated at the right hand of God the Father almighty; from there he will come to judge the living and the dead. I believe in the Holy Spirit, the holy catholic Church, the communion of saints, the forgiveness of sins, the resurrection of the body, and life everlasting. Amen." },
          { label:"Our Father", text:"Our Father, who art in heaven, hallowed be thy name; thy kingdom come; thy will be done on earth as it is in heaven. Give us this day our daily bread; and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation, but deliver us from evil. Amen." },
          { label:"Hail Mary (1st)", text:"Hail Mary, full of grace, the Lord is with thee; blessed art thou among women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen." },
          { label:"Hail Mary (2nd)", text:"Hail Mary, full of grace, the Lord is with thee; blessed art thou among women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen." },
          { label:"Hail Mary (3rd)", text:"Hail Mary, full of grace, the Lord is with thee; blessed art thou among women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen." },
          { label:"Glory Be", text:"Glory be to the Father, and to the Son, and to the Holy Spirit, as it was in the beginning, is now, and ever shall be, world without end. Amen." }
        ],
        closing: [
          { label:"Hail Holy Queen", text:"Hail, Holy Queen, Mother of Mercy, our life, our sweetness and our hope. To thee do we cry, poor banished children of Eve. To thee do we send up our sighs, mourning and weeping in this valley of tears. Turn then, most gracious advocate, thine eyes of mercy toward us, and after this our exile, show unto us the blessed fruit of thy womb, Jesus. O clement, O loving, O sweet Virgin Mary." },
          { label:"Final Prayer", text:"O God, whose only-begotten Son, by His life, death and resurrection, has purchased for us the rewards of eternal life, grant we beseech Thee, that meditating upon these mysteries of the Most Holy Rosary of the Blessed Virgin Mary, we may imitate what they contain and obtain what they promise, through the same Christ our Lord. Amen." },
          { label:"Sign of the Cross", text:"In the name of the Father, and of the Son, and of the Holy Spirit. Amen." }
        ],
        mysteries: {
          joyful: [
            { title:"First Joyful Mystery: The Annunciation", description:"The Angel Gabriel announces to Mary that she will conceive and bear the Son of God.", verse:"Luke 1:26-38", meditation:"Reflect on Mary's humility and trust in God's plan. Consider how we can say 'yes' to God in our own lives, even when His will seems difficult to understand." },
            { title:"Second Joyful Mystery: The Visitation", description:"Mary visits her cousin Elizabeth, who is pregnant with John the Baptist.", verse:"Luke 1:39-45", meditation:"Contemplate Mary's charity in serving others despite her own condition. Think about how we can bring Christ to others through our actions and presence." },
            { title:"Third Joyful Mystery: The Nativity", description:"Jesus is born in Bethlehem and laid in a manger.", verse:"Luke 2:1-20", meditation:"Meditate on the humility of God becoming man in such simple circumstances. Consider the poverty and simplicity that marked Christ's birth." },
            { title:"Fourth Joyful Mystery: The Presentation", description:"Mary and Joseph present the infant Jesus in the Temple according to Jewish law.", verse:"Luke 2:22-38", meditation:"Reflect on Mary and Joseph's obedience to God's law and Simeon's prophecy. Think about how we can dedicate our lives to God's service." },
            { title:"Fifth Joyful Mystery: Finding Jesus in the Temple", description:"After three days of searching, Mary and Joseph find the twelve-year-old Jesus teaching in the Temple.", verse:"Luke 2:41-52", meditation:"Consider Mary's anguish and joy. Reflect on how we sometimes lose Jesus through sin and the joy of finding Him again through repentance." }
          ],
          sorrowful: [
            { title:"First Sorrowful Mystery: The Agony in the Garden", description:"Jesus prays in the Garden of Gethsemane and accepts His Father's will.", verse:"Matthew 26:36-46", meditation:"Contemplate Jesus's human fear and divine obedience. Reflect on accepting God's will in times of difficulty and the importance of prayer in times of trial." },
            { title:"Second Sorrowful Mystery: The Scourging at the Pillar", description:"Jesus is brutally whipped by Roman soldiers.", verse:"John 19:1", meditation:"Meditate on Jesus's physical suffering endured for our sins. Consider how our sins contribute to His pain and our need for repentance." },
            { title:"Third Sorrowful Mystery: The Crowning with Thorns", description:"Soldiers mock Jesus by placing a crown of thorns on His head.", verse:"John 19:2-3", meditation:"Reflect on the mockery Jesus endured and His patience in suffering. Think about how we can bear insults and humiliation with grace." },
            { title:"Fourth Sorrowful Mystery: The Carrying of the Cross", description:"Jesus carries His cross to Calvary, falling three times under its weight.", verse:"Luke 23:26-32", meditation:"Consider Jesus's determination to complete His mission despite exhaustion. Reflect on how we can persevere in carrying our own crosses." },
            { title:"Fifth Sorrowful Mystery: The Crucifixion", description:"Jesus is nailed to the cross and dies for our salvation.", verse:"Luke 23:33-46", meditation:"Meditate on the ultimate sacrifice of love. Contemplate Jesus's final words and Mary's sorrow. Consider the depth of God's love for humanity." }
          ],
          glorious: [
            { title:"First Glorious Mystery: The Resurrection", description:"Jesus rises from the dead on Easter Sunday morning.", verse:"Luke 24:1-12", meditation:"Rejoice in Christ's victory over death and sin. Reflect on the hope this gives us for our own resurrection and eternal life." },
            { title:"Second Glorious Mystery: The Ascension", description:"Jesus ascends into heaven forty days after His resurrection.", verse:"Acts 1:6-11", meditation:"Consider how Jesus prepares a place for us in heaven. Reflect on our call to focus on eternal rather than merely earthly concerns." },
            { title:"Third Glorious Mystery: The Descent of the Holy Spirit", description:"The Holy Spirit comes upon the Apostles at Pentecost.", verse:"Acts 2:1-4", meditation:"Contemplate the gifts and fruits of the Holy Spirit in our lives. Pray for courage to spread the Gospel as the Apostles did." },
            { title:"Fourth Glorious Mystery: The Assumption", description:"Mary is taken up body and soul into heavenly glory.", verse:"Revelation 12:1", meditation:"Reflect on Mary's reward for her faithfulness. Consider how our bodies are temples of the Holy Spirit and will share in resurrection." },
            { title:"Fifth Glorious Mystery: The Coronation of Mary", description:"Mary is crowned Queen of Heaven and Earth.", verse:"Revelation 12:1", meditation:"Contemplate Mary's queenship and her role as our Mother and intercessor. Ask for her help in growing closer to her Son." }
          ],
          luminous: [
            { title:"First Luminous Mystery: The Baptism of Jesus", description:"Jesus is baptized by John in the Jordan River.", verse:"Matthew 3:13-17", meditation:"Reflect on Jesus's humility in accepting baptism and the Trinity's revelation. Consider the graces received in our own baptism." },
            { title:"Second Luminous Mystery: The Wedding at Cana", description:"Jesus performs His first miracle at Mary's request.", verse:"John 2:1-11", meditation:"Contemplate Mary's intercession and her instruction to 'do whatever He tells you.' Reflect on Mary's role in our spiritual lives." },
            { title:"Third Luminous Mystery: The Proclamation of the Kingdom", description:"Jesus preaches the Gospel and calls all to repentance.", verse:"Mark 1:14-15", meditation:"Meditate on Jesus's teachings and our call to conversion. Consider how we can proclaim the Gospel through our words and actions." },
            { title:"Fourth Luminous Mystery: The Transfiguration", description:"Jesus is transfigured before Peter, James, and John on Mount Tabor.", verse:"Matthew 17:1-9", meditation:"Contemplate Jesus's divine glory revealed to strengthen the Apostles. Reflect on moments when God has revealed Himself in your life." },
            { title:"Fifth Luminous Mystery: The Institution of the Eucharist", description:"Jesus institutes the Eucharist at the Last Supper.", verse:"Luke 22:14-20", meditation:"Meditate on Jesus's gift of Himself in the Eucharist. Consider the great love shown in this sacrament and our response to it." }
          ]
        }
      },
      divineMercy: [
        { label:"Sign of the Cross", text:"In the name of the Father, and of the Son, and of the Holy Spirit. Amen."},
        { label:"Our Father", text:"Our Father, who art in heaven, hallowed be thy name; thy kingdom come; thy will be done on earth as it is in heaven. Give us this day our daily bread; and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation, but deliver us from evil. Amen."},
        { label:"Hail Mary", text:"Hail Mary, full of grace, the Lord is with thee; blessed art thou among women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen."},
        { label:"Apostles' Creed", text:"I believe in God, the Father almighty, Creator of heaven and earth, and in Jesus Christ, his only Son, our Lord, who was conceived by the Holy Spirit, born of the Virgin Mary, suffered under Pontius Pilate, was crucified, died and was buried; he descended into hell; on the third day he rose again from the dead; he ascended into heaven, and is seated at the right hand of God the Father almighty; from there he will come to judge the living and the dead. I believe in the Holy Spirit, the holy catholic Church, the communion of saints, the forgiveness of sins, the resurrection of the body, and life everlasting. Amen."},
        { label:"Eternal Father Prayer (1st Decade)", text:"Eternal Father, I offer You the Body and Blood, Soul and Divinity of Your dearly beloved Son, Our Lord Jesus Christ, in atonement for our sins and those of the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 1)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 2)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 3)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 4)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 5)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 6)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 7)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 8)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 9)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (1st - 10)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"Eternal Father Prayer (2nd Decade)", text:"Eternal Father, I offer You the Body and Blood, Soul and Divinity of Your dearly beloved Son, Our Lord Jesus Christ, in atonement for our sins and those of the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 1)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 2)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 3)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 4)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 5)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 6)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 7)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 8)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 9)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (2nd - 10)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"Eternal Father Prayer (3rd Decade)", text:"Eternal Father, I offer You the Body and Blood, Soul and Divinity of Your dearly beloved Son, Our Lord Jesus Christ, in atonement for our sins and those of the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 1)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 2)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 3)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 4)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 5)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 6)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 7)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 8)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 9)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (3rd - 10)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"Eternal Father Prayer (4th Decade)", text:"Eternal Father, I offer You the Body and Blood, Soul and Divinity of Your dearly beloved Son, Our Lord Jesus Christ, in atonement for our sins and those of the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 1)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 2)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 3)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 4)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 5)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 6)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 7)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 8)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 9)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (4th - 10)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"Eternal Father Prayer (5th Decade)", text:"Eternal Father, I offer You the Body and Blood, Soul and Divinity of Your dearly beloved Son, Our Lord Jesus Christ, in atonement for our sins and those of the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 1)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 2)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 3)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 4)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 5)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 6)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 7)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 8)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 9)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"For the sake of His sorrowful Passion (5th - 10)", text:"For the sake of His sorrowful Passion, have mercy on us and on the whole world."},
        { label:"Closing Prayer (1st time)", text:"Holy God, Holy Mighty One, Holy Immortal One, have mercy on us and on the whole world."},
        { label:"Closing Prayer (2nd time)", text:"Holy God, Holy Mighty One, Holy Immortal One, have mercy on us and on the whole world."},
        { label:"Closing Prayer (3rd time)", text:"Holy God, Holy Mighty One, Holy Immortal One, have mercy on us and on the whole world."},
        { label:"Final Prayer", text:"Eternal God, in whom mercy is endless and the treasury of compassion inexhaustible, look kindly upon us and increase Your mercy in us, that in difficult moments we might not despair nor become despondent, but with great confidence submit ourselves to Your holy will, which is Love and Mercy itself. Amen."},
        { label:"Sign of the Cross", text:"In the name of the Father, and of the Son, and of the Holy Spirit. Amen."}
      ],
      stBenedict: [
        { label:"Sign of the Cross", text:"In the name of the Father, and of the Son, and of the Holy Spirit. Amen."},
        { label:"Opening Prayer", text:"O glorious St. Benedict, sublime model of virtue, pure vessel of God's grace! Behold me, humbly prostrate before you. I implore your loving heart to pray for me before the throne of God. To you I have recourse in all the dangers which daily surround me. Shield me against my enemies, inspire me to imitate you in all things. May your blessing be with me always, so that I may see and serve God as you did, with perfect fidelity and zeal unto death. Help me by your powerful intercession to gain the crown of everlasting glory. Amen."},
        { label:"Our Father", text:"Our Father, who art in heaven, hallowed be thy name; thy kingdom come; thy will be done on earth as it is in heaven. Give us this day our daily bread; and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation, but deliver us from evil. Amen."},
        { label:"Blessed St. Benedict (1)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (2)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (3)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (4)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (5)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (6)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (7)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (8)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (9)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Blessed St. Benedict (10)", text:"Blessed St. Benedict, father of monks and guide to holiness, pray for us."},
        { label:"Closing Prayer", text:"Gracious St. Benedict, glorious father of countless monks, I venerate you as a special patron and protector. I place myself and all my concerns under your powerful protection. Preserve me from all danger to soul and body. Obtain for me from God the graces I need to serve Him faithfully on earth so that I may be found worthy to praise Him eternally in heaven. Through Christ our Lord. Amen."},
        { label:"Prayer to St. Benedict Against Evil", text:"The Holy Cross be my light! Let not the dragon be my guide! Begone Satan! Never tempt me with vain things! What you offer me is evil. Drink the poison yourself! St. Benedict, pray for us that we may be made worthy of the promises of Christ."},
        { label:"Sign of the Cross", text:"In the name of the Father, and of the Son, and of the Holy Spirit. Amen."}
      ]
    };

    // ===============================
    // State & helpers
    // ===============================
    let currentPrayerType = 'rosary';
    let currentMystery = getTodaysMystery();
    let currentHour = 'morning';
    let checkedPrayers = {};

    function getTodaysMystery() {
      const d = new Date().getDay();
      switch (d) {
        case 1: case 6: return 'joyful';    // Mon, Sat
        case 2: case 5: return 'sorrowful'; // Tue, Fri
        case 0: case 3: return 'glorious';  // Sun, Wed
        case 4: default: return 'luminous'; // Thu
      }
    }

    // Make sure startPrayer is available even if other init work fails
    function startPrayer() {
      try {
        const selected = document.getElementById('modalPrayerSelect')?.value || 'rosary';
        const mainSelect = document.getElementById('prayerTypeSelect');
        if (mainSelect) mainSelect.value = selected;

        const modal = document.getElementById('prayerModal');
        if (modal) { modal.classList.add('hidden'); modal.setAttribute('aria-hidden', 'true'); }

        switchPrayer();
      } catch (e) {
        console.error('startPrayer error:', e);
      }
    }

    function initializeApp() {
      // Hook up the Begin button defensively (in addition to inline onclick)
      const beginBtn = document.getElementById('beginPrayerBtn');
      if (beginBtn) beginBtn.addEventListener('click', startPrayer);

      // Preselect today's mysteries (guard if element missing)
      const mysterySel = document.getElementById('mysterySelect');
      if (mysterySel) mysterySel.value = currentMystery;

      // Liturgy of the Hours button
      const openHourBtn = document.getElementById('openHourBtn');
      if (openHourBtn) openHourBtn.addEventListener('click', openHour);

      // Show Rosary by default
      const rosarySection = document.getElementById('rosary');
      if (rosarySection) rosarySection.classList.add('active');

      renderPrayers();

      // Daily readings UI
      const openBtn = document.getElementById('openReadingBtn');
      if (openBtn) openBtn.addEventListener('click', openReading);

      const frame = document.getElementById('readingsFrame');
      if (frame) frame.src = 'https://universalis.com/mass.htm';

      // Hide modal on Escape for convenience
      document.addEventListener('keydown', (e)=>{
        if (e.key === 'Escape') {
          const modal = document.getElementById('prayerModal');
          if (modal && !modal.classList.contains('hidden')) {
            modal.classList.add('hidden');
            modal.setAttribute('aria-hidden','true');
          }
        }
      });
    }

    function switchPrayer() {
      currentPrayerType = document.getElementById('prayerTypeSelect')?.value || 'rosary';
      checkedPrayers = {};

      document.querySelectorAll('.prayer-section').forEach(s => s.classList.remove('active'));
      const current = document.getElementById(currentPrayerType);
      if (current) current.classList.add('active');

      if (currentPrayerType !== 'daily-readings' && currentPrayerType !== 'liturgy-hours') renderPrayers();
    }

    function switchMystery() {
      currentMystery = document.getElementById('mysterySelect')?.value || currentMystery;
      checkedPrayers = {};
      renderPrayers();
    }

    function switchHour() {
      currentHour = document.getElementById('hourSelect')?.value || 'morning';
    }

    function renderPrayers() {
      if (currentPrayerType === 'rosary') renderRosary();
      else if (currentPrayerType === 'divine-mercy') renderDivineMercy();
      else if (currentPrayerType === 'st-benedict') renderStBenedict();
    }

    // ===============================
    // Rosary (with verse line)
    // ===============================
    function renderRosary() {
      const container = document.getElementById('rosaryPrayers');
      if (!container) return;
      let html = '';
      let idx = 0;

      html += '<div class="mystery-group"><div class="mystery-title">Opening Prayers</div>';
      prayerData.rosary.opening.forEach(p => html += createPrayerHTML(p, idx++));
      html += '</div>';

      const mysteries = prayerData.rosary.mysteries[currentMystery];
      mysteries.forEach(m => {
        html += `<div class="mystery-group">
          <div class="mystery-title">${m.title}</div>
          <div class="mystery-description">
            <strong>Mystery:</strong> ${m.description}<br/>
            <em>Scripture: ${m.verse}</em>
          </div>
          <div class="meditation-instructions"><h4>How to Meditate:</h4><p>${m.meditation}</p></div>`;

        html += createPrayerHTML({label:"Our Father", text:"Our Father, who art in heaven, hallowed be thy name; thy kingdom come; thy will be done on earth as it is in heaven. Give us this day our daily bread; and forgive us our trespasses as we forgive those who trespass against us; and lead us not into temptation, but deliver us from evil. Amen."}, idx++);

        for (let i=1;i<=10;i++){
          html += createPrayerHTML({label:`Hail Mary (${i})`, text:"Hail Mary, full of grace, the Lord is with thee; blessed art thou among women, and blessed is the fruit of thy womb, Jesus. Holy Mary, Mother of God, pray for us sinners, now and at the hour of our death. Amen."}, idx++);
        }

        html += createPrayerHTML({label:"Glory Be", text:"Glory be to the Father, and to the Son, and to the Holy Spirit, as it was in the beginning, is now, and ever shall be, world without end. Amen."}, idx++);
        html += createPrayerHTML({label:"Fatima Prayer", text:"O my Jesus, forgive us our sins, save us from the fires of hell, lead all souls to Heaven, especially those most in need of Thy mercy. Amen."}, idx++);
        html += '</div>';
      });

      html += '<div class="mystery-group"><div class="mystery-title">Closing Prayers</div>';
      prayerData.rosary.closing.forEach(p => html += createPrayerHTML(p, idx++));
      html += '</div>';

      container.innerHTML = html;
    }

    // ===============================
    // Divine Mercy / St Benedict
    // ===============================
    function renderDivineMercy() {
      const container = document.getElementById('divineMercyPrayers');
      if (!container) return;
      let html = '';
      prayerData.divineMercy.forEach((p,i)=> html += createPrayerHTML(p,i));
      container.innerHTML = html;
    }

    function renderStBenedict() {
      const container = document.getElementById('stBenedictPrayers');
      if (!container) return;
      let html = '';
      prayerData.stBenedict.forEach((p,i)=> html += createPrayerHTML(p,i));
      container.innerHTML = html;
    }

    // ===============================
    // Shared UI Helpers
    // ===============================
    function createPrayerHTML(prayer, index) {
      const key = `${currentPrayerType}_${currentMystery}_${index}`;
      const isChecked = checkedPrayers[key] || false;
      return `
        <div class="prayer-item">
          <div class="prayer-checkbox">
            <input type="checkbox" id="prayer_${index}" ${isChecked?'checked':''}
                   onchange="updatePrayerStatus(${index})">
            <div>
              <span class="prayer-label">${prayer.label}</span>
              <div class="prayer-text">${prayer.text}</div>
            </div>
          </div>
        </div>
      `;
    }
    function updatePrayerStatus(index) {
      const key = `${currentPrayerType}_${currentMystery}_${index}`;
      checkedPrayers[key] = document.getElementById(`prayer_${index}`).checked;
    }

    // ===============================
    // Liturgy of the Hours
    // ===============================
    function openHour() {
      const source = document.getElementById('liturgySourceSelect').value;
      const hourUrls = {
        'office-readings': 'office.htm',
        'morning': 'lauds.htm',
        'midmorning': 'terce.htm',
        'midday': 'sext.htm',
        'midafternoon': 'none.htm',
        'evening': 'vespers.htm',
        'night': 'compline.htm'
      };

      const baseUrl = source === 'universalis-mobile' 
        ? 'https://universalis.com/mobile.htm#'
        : 'https://universalis.com/';

      const frame = document.getElementById('liturgyFrame');
      if (frame && hourUrls[currentHour]) {
        frame.src = baseUrl + hourUrls[currentHour];
      }
    }

    // ===============================
    // Daily Readings
    // ===============================
    function buildUsccbUrl(d) {
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const yy = String(d.getFullYear()%100).padStart(2,'0');
      return `https://bible.usccb.org/bible/readings/${mm}${dd}${yy}.cfm`;
    }

    function showTextOnlyReadings() {
      document.getElementById('readingsFrameWrap').style.display = 'none';
      document.getElementById('readingsTextWrap').style.display = 'block';
      document.getElementById('readingsCredit').innerHTML =
        'Text-only mode via <a href="https://www.universalis.com/n-jsonp.htm" target="_blank" rel="noopener">Universalis JSONP</a>.';

      if (!document.getElementById('universalis-js')) {
        loadUniversalisJSONP('USA'); // US calendar
      } else {
        postFillAdjustments();
      }
    }

    function showInlineUniversalis() {
      document.getElementById('readingsTextWrap').style.display = 'none';
      document.getElementById('readingsFrameWrap').style.display = 'block';
      const frame = document.getElementById('readingsFrame');
      frame.src = 'https://universalis.com/mass.htm';
      document.getElementById('readingsCredit').innerHTML =
        'Full page via <a href="https://www.universalis.com" target="_blank" rel="noopener">Universalis</a>.';
    }

    function openReading() {
      const choice = document.getElementById('readingSelect').value;
      if (choice === 'usccb') {
        const url = buildUsccbUrl(new Date());
        window.open(url, '_blank', 'noopener');
        document.getElementById('readingsCredit').innerHTML = 'USCCB opened in a new tab.';
      } else if (choice === 'universalis-text') {
        showTextOnlyReadings();
      } else {
        showInlineUniversalis();
      }
    }

    // ----- Universalis JSONP support -----
    function setUniversalisElement(thing, text) {
      const where = document.getElementById("Universalis_" + thing);
      if (where) where.innerHTML = text;
    }

    function universalisCallback(data) {
      for (var thing in data) {
        var d = data[thing];
        if (typeof d != "object") {
          setUniversalisElement(thing, d);
        } else {
          for (var t in d) {
            var dd = d[t];
            setUniversalisElement(thing + "." + t, dd);
          }
        }
      }
      postFillAdjustments();
    }

    function postFillAdjustments(){
      const r2 = document.getElementById('Universalis_Mass_R2.text');
      const r2Card = document.getElementById('secondReadingCard');
      if (r2 && r2Card) {
        const hasText = r2.innerHTML && r2.innerHTML.trim().length > 0;
        r2Card.style.display = hasText ? 'block' : 'none';
      }
    }

    function loadUniversalisJSONP(region) {
      (function(d, id, region, day){
        function yyyymmdd(day){
          var now = new Date();
          var delta = (day === 7) ? (7 - now.getDay()) : 0; // 1=today, 7=next Sunday
          var when = new Date(now.getTime() + 86400000 * delta);
          return (1900 + when.getYear()) * 10000 + (1 + when.getMonth()) * 100 + when.getDate();
        }
        var js, fjs = d.getElementsByTagName('script')[0];
        if (!d.getElementById(id)) {
          js = d.createElement('script');
          js.id = id;
          js.src = document.location.protocol + '//universalis.com/' +
                   (region ? (region + '/') : '') +
                   yyyymmdd(1) + '/jsonpmass.js?callback=universalisCallback';
          fjs.parentNode.insertBefore(js, fjs);
        }
      })(document, 'universalis-js', region || '', 1);
    }

    // Boot early (DOMContentLoaded is more reliable than window.load here)
    document.addEventListener('DOMContentLoaded', initializeApp);
    // Also expose startPrayer globally (safety)
    window.startPrayer = startPrayer;
    window.switchHour = switchHour;
  </script>
</body>
</html>
